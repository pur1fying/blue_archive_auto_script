# 文字识别(OCR)

## OCR 将会使用[C++重构](https://github.com/pur1fying/BAAS_Cpp), 作为项BAAS的子进程提供服务, 提供以下api


## **基础信息**
| 项目       | 说明               |
|----------|------------------|
| **地址**   | `localhost:1145` |

## **API列表**

### 初始化模型

#### **请求信息**
| 方法     | URL           |
|--------|---------------|
| `POST` | `/init_model` |

#### **请求头**
| 参数             | 说明        | 示例值                |
|----------------|-----------|--------------------|
| `Content-Type` | 指定请求的数据格式 | `application/json` |

#### **请求体**
| 参数           | 类型             | 必填 | 说明      |
|--------------|----------------|----|---------|
| `language`   | `List[str]`    | 是  | 语言      |
| `gpu_id`     | `int`          | 否  | gpu id  |
| `num_thread` | `int`          | 否  | 推理线程数   |


#### **响应体**
| 类型          | 说明                            |
|-------------|-------------------------------|
| `List[int]` | `最后一个int表示初始化时间, 前面每个数字含义如下表` |

| 值   | 含义        |
|-----|-----------|
| `0` | 不存在的语言    |
| `1` | `success` |
| `2` | 已经初始化过    |

### 释放模型

#### **请求信息**
| 方法     | URL              |
|--------|------------------|
| `POST` | `/release_model` |

#### **请求头**
| 参数             | 说明        | 示例值                |
|----------------|-----------|--------------------|
| `Content-Type` | 指定请求的数据格式 | `application/json` |

#### **请求体**
| 参数         | 类型          | 必填 | 说明       |
|------------|-------------|----|----------|
| `language` | `List[str]` | 是  | 语言       |

**note**: onnxruntime C++ 库存在内存泄露问题, 所以请勿频繁 加载 / 释放 模型

#### **响应体**
| 类型           | 说明                            |
|--------------|-------------------------------|
| `List[bool]` | `最后一个int表示初始化时间, 前面每个数字含义如下表` |

| 值       | 含义        |
|---------|-----------|
| `false` | 不存在的语言    |
| `true`  | `success` |

### 释放所有模型

#### **请求信息**
| 方法    | URL            |
|-------|----------------|
| `Get` | `/release_all` |


### 获取图像的文字框

#### **请求信息**
| 方法     | URL             |
|--------|-----------------|
| `POST` | `/get_text_box` |

#### **请求头**
| 参数             | 说明        | 示例值                |
|----------------|-----------|--------------------|
| `Content-Type` | 指定请求的数据格式 | `application/json` |

#### **请求体**
| 参数                          | 类型             | 必填 | 说明           |
|-----------------------------|----------------|----|--------------|
| `/image/pass_method`        | `unsigned int` | 是  | 图像传递方式       |
| `/image/local_path`         | `string`       | 否  | 图像本地路径       |
| `/image/shared_memory_name` | `string`       | 否  | 图像数据所在的共享内存名 |

### ocr_for_single_line

#### **请求信息**
| 方法     | URL                    |
|--------|------------------------|
| `POST` | `/ocr_for_single_line` |

#### **请求头**
| 参数             | 说明        | 示例值                |
|----------------|-----------|--------------------|
| `Content-Type` | 指定请求的数据格式 | `application/json` |

#### **请求体**
| 参数                          | 类型             | 必填 | 说明           |
|-----------------------------|----------------|----|--------------|
| `/language`                 | `string`       | 是  | 语言           |
| `/candidates`               | `string`       | 否  | 可能出现的字       |
| `/image/pass_method`        | `unsigned int` | 是  | 图像传递方式       |
| `/image/local_path`         | `string`       | 否  | 图像本地路径       |
| `/image/shared_memory_name` | `string`       | 否  | 图像数据所在的共享内存名 |

### ocr

#### **请求信息**
| 方法     | URL    |
|--------|--------|
| `POST` | `/ocr` |

#### **请求头**
| 参数             | 说明        | 示例值                |
|----------------|-----------|--------------------|
| `Content-Type` | 指定请求的数据格式 | `application/json` |

#### **请求体**
| 参数                          | 类型             | 必填 | 说明           |
|-----------------------------|----------------|----|--------------|
| `/language`                 | `string`       | 是  | 语言           |
| `/candidates`               | `string`       | 否  | 可能出现的字       |
| `/image/pass_method`        | `unsigned int` | 是  | 图像传递方式       |
| `/image/local_path`         | `string`       | 否  | 图像本地路径       |
| `/image/shared_memory_name` | `string`       | 否  | 图像数据所在的共享内存名 |





## 可选的语言
| language | 语言     |
|----------|--------|
| `zh-cn`  | `简体中文` |
| `zh-tw`  | `繁体中文` |
| `en-us`  | `英文`   |
| `ja-jp`  | `日文`   |
| `ko-kr`  | `韩文`   |
| `ru-ru`  | `俄文`   |


## 图像传递方式

### 本地图像
1. 共享内存传递
2. 提供图像路径, ocr_server读取图像
3. 传递图像二进制数据

### 远程图像
1. 传递png文件
2. 传递图像二进制数据

## pass_method
| 值	 | 传递方式	            | 必填参数                   |
|----|------------------|------------------------|
| 1	 | 共享内存             | 	shared_memory_name    |
| 2	 | 本地路径             | 	local_path            |
| 3	 | 图像二进制数据 (Base64) | 	image_data（Base64字符串） |